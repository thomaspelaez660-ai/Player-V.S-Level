- name: Install Android SDK
  run: |
    # 1️⃣ Make sure core utilities exist
    sudo apt-get update
    sudo apt-get install -y coreutils wget unzip zip openjdk-11-jdk

    # 2️⃣ Create cmdline-tools folder
    mkdir -p $HOME/android-sdk/cmdline-tools
    cd $HOME/android-sdk/cmdline-tools

    # 3️⃣ Download and extract command line tools if not already present
    if [ ! -d latest ]; then
      wget https://dl.google.com/android/repository/commandlinetools-linux-10406996_latest.zip -O cmdline-tools.zip
      unzip cmdline-tools.zip
      rm cmdline-tools.zip
      mv cmdline-tools latest
    fi

    # 4️⃣ Accept all SDK licenses
    yes | $HOME/android-sdk/cmdline-tools/latest/bin/sdkmanager --sdk_root=$HOME/android-sdk --licenses

    # 5️⃣ Install required platform-tools, build-tools, and platforms
    $HOME/android-sdk/cmdline-tools/latest/bin/sdkmanager --sdk_root=$HOME/android-sdk \
      "platform-tools" "platforms;android-31" "build-tools;31.0.0"

  env:
    PATH: $HOME/android-sdk/cmdline-tools/latest/bin:$PATH